trigger:
- main

parameters:
  - name: androidAppId
    displayName: 'Existing Android App ID (optional)'
    type: string
    default: ' '
  - name: testSuiteId
    displayName: 'Existing Test Suite ID (optional)'
    type: string
    default: ' '

resources:
  pipelines:
    - pipeline: build
      source: 'aapp_app_mobile [build]'
      trigger:
        branches:
          include:
            - main

schedules:
  - cron: "0 0 * * *"   # every night
    displayName: Scheduled E2E Test
    branches:
      include:
        - main
    always: true  # run even if no recent changes

variables:
  - group: aapp_testing_e2e
  - name: devices
    value: |
      Samsung Galaxy S25-15.0
      Samsung Galaxy S24-16.0
      Google Pixel 8 Pro-14.0
      OnePlus 11R-13.0

pool:
      vmImage: 'macOS-15'

steps:
- script: |
    devices=("${{ variables.devices }}" )
    IFS=$'\n' read -rd '' -a device_array <<<"$devices"
    RANDOM_DEVICE="${device_array[$((RANDOM % ${#device_array[@]}))]}"
    echo "##vso[task.setvariable variable=randomDevice]$RANDOM_DEVICE"
  displayName: 'Pick random device'

- template: templates/shared.yml
  parameters:
    appId: ${{ parameters.androidAppId }}
    testSuiteId: ${{ parameters.testSuiteId }}
    buildArtifact: 'android-build'
    appFileName: 'android/app/build/outputs/apk/dev/release/app-dev-release.apk'
    platform: 'android'
    device: $(randomDevice)
    buildApiUrl: 'https://api-cloud.browserstack.com/app-automate/maestro/v2/android/build'
